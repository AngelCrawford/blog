<nav class="navbar" aria-label="main navigation">
  <div class="navbar-brand">

    <a class="is-mobile navbar-item {{ if .Page.IsHome }}is-active{{ end }} navbar-logo " href="/" title="{{ .Name }} page">
      <img src="/images/clock.png" alt="Logo"><span>{{ .Site.Title }}</span>
    </a>

    
    <div class="navbar-item is-hidden-desktop">
      {{ partialCached "social-follow-header.html" . }}
    </div>

    <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="navbarHeader">
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
    </a>
  </div>

  <div class="navbar-menu" id="navbarHeader">
      
    <div class="navbar-start">
      {{- $currentPage := . -}}
      {{- range .Site.Menus.main -}}

        {{- if .HasChildren -}}
          <div class="navbar-item has-dropdown is-hoverable is-mega">
            <a class="navbar-link {{ if or ($currentPage.IsMenuCurrent "main" .) ($currentPage.HasMenuCurrent "main" .) }} is-active{{ end }}" href="{{ .URL }}">
              {{- .Name -}}
            </a>
            <div id="blogDropdown" class="navbar-dropdown">

              <div class="container is-fluid">
                <div class="columns is-multiline">
                    {{- range .Children -}}
                      {{- $.Scratch.Set "CatName" .Name -}}
                      <div class="column is-4">

                        <a class="navbar-link is-arrowless" href="">
                          <div class="navbar-content">
                            <!-- TODO: Wenn neuer Artikel, Batch mit "new" hinzufÃ¼gen. -->
                            
                            {{- with $.Site.GetPage .URL -}}
                              {{- if .Resources -}}
                                <figure class="image is-2by3">
                                  {{- $img := (.Resources.ByType "image").GetMatch "featured*" -}}
                                  {{- with $img -}}
                                    {{- $resize := .Fill "320x480" -}}
                                      <img src="{{ $resize.RelPermalink }}" alt="{{ $.Title }}">
                                  {{- end -}}
                                </figure>
                              {{- end -}}
                            {{- end -}}

                            <p class="title is-5" style='color: 
                            {{- range $.Site.Params.categoryColor -}}
                              {{- if eq ($.Scratch.Get "CatName") .name -}}
                                {{- .color -}}
                              {{- end -}}
                            {{- end -}}'>{{ .Name }}</p>
                            
                            {{- with $.Site.GetPage .URL -}}
                              {{ .Content | truncate "200" }}
                            {{- end -}}

                          </div>
                        </a>

                      </div>
                    {{- end -}}

                    {{- $.Scratch.Delete "CatName" -}}
    
                </div>
              </div>
    
            </div>
          </div>

        {{- else -}}

          <a class="navbar-item {{ if or ($currentPage.IsMenuCurrent "main" .) ($currentPage.HasMenuCurrent "main" .) }} is-active{{ end }}" href="{{ .URL }}" title="{{ .Name }} page">
            {{- .Name -}}
          </a>
        {{- end -}}
        
      {{- end -}}

      <div class="navbar-item has-dropdown is-hoverable">
        <div class="navbar-link">
          More
        </div>
        <div id="moreDropdown" class="navbar-dropdown ">
          <a class="navbar-item " href="http://bulma.io/extensions/">
            <div class="level is-mobile">
              <div class="level-left">
                <div class="level-item">
                  <p>
                    <strong>Extensions</strong>
                    <br>
                    <small>Side projects to enhance Bulma</small>
                  </p>
                </div>
              </div>
              <div class="level-right">
                <div class="level-item">
                  <svg class='remix-small'>
                    <use xlink:href="/fonts/remixicon/remixicon.symbol.svg#calendar-line"></use>
                  </svg>
                </div>
              </div>
            </div>
          </a>
        </div>
      </div>

    </div>

    <div class="navbar-end">
      <div class="navbar-item is-hidden-touch has-no-hover-border">
        {{ partialCached "social-follow-header.html" . }}
      </div>
      
      <div class="navbar-item field">
        <div class="searchWithButton">
          <label for="searchBox" class="visible-hidden">Search Box</label>
          <input class="input" type="search" name="searchBox" id="searchBox" placeholder="Search...">
          <button id="searchIcons" class="icon is-small is-right" aria-label="Search Icon">
            <svg class='remix lens'><use xlink:href="/fonts/remixicon/remixicon.symbol.svg#search-2-line"></use></svg>
            <svg class='remix close'><use xlink:href="/fonts/remixicon/remixicon.symbol.svg#close-fill"></use></svg>
            <div id="spinnerLoading" class="control spinner is-loading"></div>
          </button>
        </div>
        <div id="resultsWrapper"><div id="results"></div></div>
      </div>
    </div>
    
  </div>

</nav>
  