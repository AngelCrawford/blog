<article class="card is-horizontal {{ if .Resources }}has-image{{else}}no-image{{ end }} has-ribbon">

  {{ if .Resources }}
    <div class="card-image">
      <!-- // HACK: Is this right? -->
      <figure class="image is-2by3">
        <a href="{{ .Permalink }}">
          {{- $img := (.Resources.ByType "image").GetMatch "featured*" -}}
          {{- with $img -}}
            {{- $resize := .Fill "320x480" -}}
              <img src="{{ $resize.RelPermalink }}" alt="{{ $.Title }}">
          {{- end -}}
        </a>
        {{- range .Params.featured_image -}}
          <figcaption>
            <svg class='remix'><use xlink:href="/fonts/remixicon/remixicon.symbol.svg#information-line"></use></svg>
            {{ .byline | safeHTML }}
          </figcaption>
        {{- end -}}
      </figure>
    </div>
  {{ end }}
  
  {{ if .GetTerms "categories" }}
    {{ range first 1 (.GetTerms "categories") }}
      {{ $catName := .LinkTitle }}
      <div class="ribbon" style="{{ range .Site.Params.categoryColor }}{{ if eq .name $catName }}background-color: {{ .color }};{{ end }}{{ end }}">
        <a href="{{ .RelPermalink }}">{{ .LinkTitle }}</a>
      </div>
    {{ end }}
  {{ end }}

  <div class="card-content">
    <div class="media-content">

      <div class="card-title">
        <a class="title is-4" href="{{ .RelPermalink }}"><h2>{{ .Title }}</h2></a>
      </div>
      
      <span class="heading">
        <time datetime="{{ .PublishDate.Format "2006-01-02T15:04:05Z07:00" }}">
          <svg class='remix-small'>
            <use xlink:href="/fonts/remixicon/remixicon.symbol.svg#calendar-line"></use>
          </svg> {{ .PublishDate.Format "02.01.06" }}
        </time>
        <time class="updated" datetime="{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}">
          <svg class='remix-small'>
            <use xlink:href="/fonts/remixicon/remixicon.symbol.svg#pencil-line"></use>
          </svg> {{ .Lastmod.Format "02.01.06" }}
        </time>
      </span>
    </div>

    <div class="content">
      {{- if .Params.rating -}}
        <div class="rating">{{ partial "rating" . }} ({{ .Params.rating }})</div>
      {{- end -}}

      {{ if eq .Params.weight 1 }}
        <!-- // FIXME: Wenn ich Content hier verwende, dann wird "summary" im Frontend nicht benutzt -->
        <!-- // FIXME: Shortcodes werden ebenfalls mit ausgeben, zwar ohne HTML, aber dennoch -->
        {{ if .Params.summary }}
          {{ .Summary | truncate 800 " [...]" }}
        {{ else }}
          {{ .Content | truncate 800 " [...]" | markdownify }}
        {{ end }}
      {{ else if not .Resources }}
        {{ .Summary | truncate 500 " [...]" }}
      {{ else }}
        {{- with .Params.description -}}
          <b>{{ . | truncate 160 }}</b>
          {{ $.Summary | truncate 180 " [...]" }}
          {{ else }}
            {{ $.Summary | truncate 300 " [...]" }}
        {{- end -}}
      {{ end }}
      
      <a class="read-more" href="{{ .RelPermalink }}">{{ i18n "readMore" }}</a>
      <!-- <a class="read-more" href="{{ .RelPermalink }}"></a> -->

      {{- if (.GetTerms "tags") -}}
        <div class="tags-wrapper">
          <svg class='remix-small'>
            <use xlink:href="/fonts/remixicon/remixicon.symbol.svg#price-tag-3-line"></use>
          </svg>
          {{- range (.GetTerms "tags") -}}
            <a href="{{ .RelPermalink }}" class="hashtags">#{{ .LinkTitle }} </a> 
          {{- end -}}
        </div>
      {{- end -}}

    </div>
  </div>

  <footer class="card-footer">
    <div class="author-img">
      {{ range (.GetTerms "authors") }}
        <figure class="image is-48x48">
          <a href="{{ .Permalink }}">
            {{- range first 1 (.Resources.ByType "image") -}}
              {{- $img := .Fill "48x48" | images.Filter images.Grayscale -}}
              <img class="is-rounded" src="{{ $img.RelPermalink }}" alt="{{ $.Title }}">
            {{- end -}}
          </a>
        </figure>
      {{ end }}
    </div>

    <span class="card-footer-item">
      <svg class='remix-small'>
        <use xlink:href="/fonts/remixicon/remixicon.symbol.svg#time-line"></use>
      </svg> {{ .ReadingTime }} {{ i18n "minutesRead" }}

      <svg class='remix-small comments'>
        <use xlink:href="/fonts/remixicon/remixicon.symbol.svg#question-answer-line"></use>
      </svg> Kritiken
    </span>

    <!--  // TODO: Tooltips hinzufÃ¼gen -->
    <span class="card-footer-item">
      {{ if .Params.weight }}
        <svg class='remix-small'>
          <use xlink:href="/fonts/remixicon/remixicon.symbol.svg#pushpin-line"></use>
        </svg>
      {{ end }}
      <svg class='remix-small'>
        <use xlink:href="/fonts/remixicon/remixicon.symbol.svg#article-line"></use>
      </svg>

      {{ if .Params.rating }}
        <svg class='remix-small'>
          <use xlink:href="/fonts/remixicon/remixicon.symbol.svg#film-line"></use>
        </svg>
      {{ end }}
      {{ if .Params.series }}
        <svg class='remix-small'>
          <use xlink:href="/fonts/remixicon/remixicon.symbol.svg#stack-line"></use>
        </svg>
      {{ end }}
      
      {{ range (.GetTerms "contains") }}
        {{ if eq .Title "code" }}
          <svg class='remix-small'>
            <use xlink:href="/fonts/remixicon/remixicon.symbol.svg#code-s-slash-fill"></use>
          </svg>
        {{ end }}
        {{ if eq .Title "instagram" }}
          <svg class='remix-small'>
            <use xlink:href="/fonts/remixicon/remixicon.symbol.svg#instagram-line"></use>
          </svg>
        {{ end }}
        {{ if eq .Title "twitter" }}
          <svg class='remix-small'>
            <use xlink:href="/fonts/remixicon/remixicon.symbol.svg#twitter-line"></use>
          </svg>
        {{ end }}
        {{ if eq .Title "youtube" }}
          <svg class='remix-small'>
            <use xlink:href="/fonts/remixicon/remixicon.symbol.svg#youtube-line"></use>
          </svg>
        {{ end }}
        {{ if eq .Title "image" }}
          <svg class='remix-small'>
            <use xlink:href="/fonts/remixicon/remixicon.symbol.svg#camera-line"></use>
          </svg>
        {{ end }}
        {{ if eq .Title "gallery" }}
          <svg class='remix-small'>
            <use xlink:href="/fonts/remixicon/remixicon.symbol.svg#gallery-line"></use>
          </svg>
        {{ end }}
      {{ end }}
        

      {{ $comments := readDir "data/comments" }}
      <!-- //TODO: ReadDir ersetzen? Siehe https://jameskiefer.com/posts/threaded-comments-for-hugo-with-staticman-v3/ -->
      {{ $.Scratch.Set "hasComments" 0 }}
      {{ $postSlug := $.File.ContentBaseName }}

      {{ range $comments }}
        {{ if eq .Name $postSlug }}
          {{ range $index, $comments := (index $.Site.Data.comments $postSlug ) }}
            {{ $.Scratch.Add "hasComments" 1 }}
          {{ end }}
        {{ end }}
      {{ end }}
      <h4>Has comments: {{ $.Scratch.Get "hasComments" }}</h4>
      {{ $.Scratch.Delete "hasComments" }}


    </span>
  </footer>
</article>