
{{ if and .Site.Params.staticman (not (or .Site.Params.disable_comments .Params.disable_comments)) }}
  <section id="comments" class="box">
  {{ if .Site.Params.staticman }}
    <h3 class="title"><a href="#comments">Comments</a></h3>
    <section class="staticman-comments post-comments">
      {{ $comments := readDir "data/comments" }}
      <!-- //TODO: ReadDir ersetzen? Siehe https://jameskiefer.com/posts/threaded-comments-for-hugo-with-staticman-v3/ -->
      {{ $.Scratch.Set "hasComments" 0 }}
      {{ $postSlug := $.File.ContentBaseName }}

      {{ if eq ($.Scratch.Get "hasComments") 0 }}
        <h3>Be the first to leave a comment! ðŸŽ‰</h3>
      {{ end }}
  
      {{ range $comments }}
        {{ if eq .Name $postSlug }}
          {{ range $index, $comments := (index $.Site.Data.comments $postSlug ) }}
          {{ $.Scratch.Add "hasComments" 1 }}
          {{ if not .reply_to }}  

            <article id="commentid-{{ ._id }}" class="media post-comment">
              <figure class="media-left">
                <p class="image is-64x64"><img src="https://www.gravatar.com/avatar/{{ .email }}?s=70&r=pg&d=mp"></p>
              </figure>

              <div class="media-content">
                <div class="content">
                  <p><strong>{{ .name }}</strong> @{{ .website }}
                  <br>{{ .comment | markdownify }}</p>
                  
                  <small>
                    <button id="{{ ._id }}" class="btn-info" href="#comment-form" onclick="changeValue('fields[reply_to]', '{{ ._id }}')">Reply to {{ .name }}</button>
                    <a href="#commentid-{{ ._id }}" title="Permalink to this comment">
                      <time class="post-time">{{ (time .date).Add (2 | duration "hour" ) | dateFormat "02.01.06 um 15:04:05 Uhr" }}</time>
                    </a>
                  </small>
                </div>

                {{ partial "comments/comment-replies" (dict "entryId_parent" $postSlug "SiteDataComments_parent" $.Site.Data.comments "parentId" ._id "parentName" .name "context" .) }}
              </div>
            </article>
          {{ end }}
        {{ end }}
      {{ end }}
    {{ end }}
  {{ end }}

  </section>

  <!-- //TODO: JavaScript hinzufÃ¼gen, um die Notification zu schlieÃŸen! -->
  <article class="message is-primary" id="comment-submitted">
    <div class="message-header">
      <p>Thank you!</p>
      <button class="delete" aria-label="delete"></button>
    </div>
    <div class="message-body">
      <p>Your comment has been submitted and will be published once it has been approved. &#128522;</p>
      <p><a href="https://github.com/{{ .Site.Params.staticman.username }}/{{ .Site.Params.staticman.repository }}/pulls" target="_blank">Click here</a> 
      to see the pull request you generated.</p>
    </div>
  </article>

  <article class="message is-danger" id="comment-error">
    <div class="message-header">
      <p>OOPS!</p>
      <button class="delete" aria-label="delete"></button>
    </div>
    <div class="message-body">
      <p>Your comment has not been submitted. Please <a href="{{ .Permalink }}">go back</a> and try again. Thank You!</p>
      <p>If this error persists, please open an issue by <a href="https://github.com/{{ .Site.Params.staticman.username }}/{{ .Site.Params.staticman.repository }}/issues"> clicking here</a>.</p>
    </div>
  </article>
  {{ partial "comments/comment-form" . }}
{{ end }}

<h4>Has comments: {{ $.Scratch.Get "hasComments" }}</h4>
{{ $.Scratch.Delete "hasComments" }}