{{ define "main" }}
 
  <div class="columns">

    <div class="column is-single-top is-9">
      <article class="content box">

        <h1 class="title">{{ .Title | default .Site.Title }}</h1>
        {{ with .Params.description }}
          <h2 class="subtitle">{{ . | truncate 160 }}</h2>
        {{ end }}

        <div class="details-single has-ribbon">
          {{ if .Params.icons }}
            <div class="ribbon is-single-page is-primary">
              <svg class="remix-small">
                <use xlink:href="/fonts/remixicon/remixicon.symbol.svg#bookmark-line"></use>
              </svg> Details
            </div>
            <span class="details-icon-wrapper">
              {{ range .Params.icons }}
                <span {{ if .tooltip }}data-tooltip="{{ .tooltip }}"{{ end }}>
                  <svg class="remix-big" style="fill: {{ .color }};">
                    <use xlink:href="/fonts/remixicon/remixicon.symbol.svg#{{ .src }}"></use>
                  </svg>
                </span>
              {{ end }}
            </span>
          {{ end }}
        </div>
        
        {{ .Content }}
  
        {{ if .Params.series }}
          <div class="series-single-footer">
            {{ partial "series-footer" . }}
          </div>
        {{ end }}
      </article>
    </div>
    
    <div class="column is-single-top is-3">
      <div class="single-information">
        <p class="title is-4">Information</p>
        
        {{- if .Params.categories -}}
          <div class="categories-single">
            {{ range first 1 (.GetTerms "categories") }}
              {{ $catName := .LinkTitle }}
              <span class="tag" style="{{ range .Site.Params.categoryColor }}{{ if eq .name $catName }}background-color: {{ .color }};{{ end }}{{ end }}">
                <a href="{{ .Permalink }}">{{ .LinkTitle }}</a>
              </span>
            {{- end -}}
          </div>
        {{- end -}}

        <div class="date-single">
          <time datetime="{{ .PublishDate.Format "2006-01-02T15:04:05Z07:00" }}">
            <svg class='remix-small'>
              <use xlink:href="/fonts/remixicon/remixicon.symbol.svg#calendar-line"></use>
            </svg>{{ .PublishDate.Day }}. {{ index $.Site.Data.demonths (printf "%d" .PublishDate.Month) }} {{ .PublishDate.Year }}
          </time>
          <time class="updated" datetime="{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}">
            <svg class='remix-small'>
              <use xlink:href="/fonts/remixicon/remixicon.symbol.svg#pencil-line"></use>
            </svg> {{ .Lastmod.Format "02.01.06" }}
          </time>
        </div>

        {{- if .Params.tags -}}
          <div class="tags-single">
            <svg class='remix-small'>
              <use xlink:href="/fonts/remixicon/remixicon.symbol.svg#price-tag-3-line"></use>
            </svg>
            {{- range (.GetTerms "tags") -}}
              <a href="{{ .RelPermalink }}" class="hashtags">#{{ .LinkTitle }} </a> 
            {{- end -}}
          </div>
        {{- end -}}

        <div class="reading-time-single">
          <svg class='remix-small'>
            <use xlink:href="/fonts/remixicon/remixicon.symbol.svg#time-line"></use>
          </svg> {{ .ReadingTime }} {{ i18n "minutesRead" }}
        </div>

        {{- if .Params.rating -}}
          <div class="ratings-single">
            <svg class='remix-small'>
              <use xlink:href="/fonts/remixicon/remixicon.symbol.svg#time-line"></use>
            </svg> 
            {{ partial "rating" . }} ({{ .Params.rating }})
          </div>
        {{- end -}}

        {{ if .Params.series }}
          <div class="series-single">
            {{ $name := index .Params.series 0 }}
            <svg class='remix-small'>
              <use xlink:href="/fonts/remixicon/remixicon.symbol.svg#stack-line"></use>
            </svg>
            This post is part of the <a href="{{.Site.BaseURL}}/series/{{$name | urlize}}">{{ $name }}</a> series.
          </div>
        {{ end }}
      </div>

      {{ if ge (len .TableOfContents) 100 }}
        <div class="toc-single">
          <p class="title is-4">Table of Content</p>
          {{ .TableOfContents }}
        </div>
      {{ end }}
      
      {{ if .Params.series }}
        <div class="serie-single">
          <p class="title is-4">Serie</p>
          {{- $currentPage := . -}}
          {{- $series_name := index .Params.series 0 -}}
          <p class="title is-6"><a href="{{.Site.BaseURL}}/series/{{$series_name | urlize}}">{{ $series_name }}</a></p>
          <ul>
            {{- range .Site.RegularPages.ByDate -}}
              {{- if in .Params.series $series_name -}}
                {{- if not (eq $currentPage.RelPermalink .RelPermalink) -}}
                  <li><a href="{{ .RelPermalink }}" title="{{ .Name }} page"><span class="small">{{ .Lastmod.Format "02.01.06" }}</span> - {{ .Title }}</a></li>
                {{- else -}}
                  <li class="is-active">{{ .Lastmod.Format "02.01.06" }} - {{ .Title }}</li>
                {{- end -}}
                
              {{- end -}}
            {{- end -}}
          </ul>
          
        </div>
      {{ end }}
    </div>

  </div>

  {{ if .Params.authors }}
    <div class="columns">
      <div class="column is-9 card-horiz-img">

          <aside class="card is-horizontal">
            {{ range (.GetTerms "authors") }}
              <div class="card-image">
                <!-- // HACK: Is this right? -->
                <figure class="image is-2by3">
                  <a href="{{ .Permalink }}">
                    {{- range first 1 (.Resources.ByType "image") -}}
                      {{- $img := .Fill "320x480" | images.Filter (images.Sepia "100") -}}
                      <img src="{{ $img.RelPermalink }}" alt="{{ $.Title }}">
                    {{- end -}}
                  </a>
                </figure>
              </div>
          
              <div class="card-content">
                <div class="card-content-wrapper">
                  <div class="media-content">
                    <a class="title is-4" href="{{ .RelPermalink }}"><h2>{{ .Title }}</h2></a>
                    
                    <span class="heading">
                      Birthdate: {{ .Params.birthdate }}
                    </span>
                  </div>
              
                  <div class="content">
                    {{ .Content }}
                  </div>
                
                  <footer class="card-footer">
                    {{ range .Params.socials }}
                      <span class="card-footer-item">
                        <a data-tooltip="{{ .name }}" href="{{ .src }}">
                          <svg class='remix-big-primary'>
                            <use xlink:href="/fonts/remixicon/remixicon.symbol.svg#{{ .icon }}-line"></use>
                          </svg>
                        </a>
                      </span>
                    {{ end }}
                  </footer>
                </div>
              </div>
            {{ end }}
          </aside>

      </div>
    </div>
  {{ end }}

  <!-- THANKS: https://www.pakstech.com/blog/hugo-related-pages/ -->
  {{ if len (where (.Site.RegularPages.Related .) "Type" "articles") }}
    <div class="columns">
      <div class="column related-content-single is-9" >
        <!-- <div class="content">
          <p class="title is-4">Related content</p>
        </div> -->
        <div class="columns">
          {{- $related := (where (.Site.RegularPages.Related .) "Type" "articles") | first 3 -}}
          {{- range $related -}}
            <div class="column is-one-third is-flex">
              <div class="card">
                <div class="card-image">
                  <figure class="image is-3by2">
                    {{- range first 1 (.Resources.ByType "image") -}}
                      {{- $img := .Fill "480x320" | images.Filter (images.Sepia "100") -}}
                      <a href="#">
                        <img src="{{ $img.RelPermalink }}" alt="{{ $.Title }}">
                      </a>
                    {{- end -}}
                    {{- with .Params.images -}}
                      {{ range first 1 . }}<figcaption>
                        <svg class='remix'><use xlink:href="/fonts/remixicon/remixicon.symbol.svg#information-line"></use></svg>
                        {{ .byline | safeHTML }}</figcaption>
                      {{ end }}
                    {{- end -}}
                  </figure>
                </div>
                <div class="card-content">
                  <a class="title is-5" href="{{ .Permalink }}">{{ .Title }}</a>
                  <span class="heading"><time datetime="{{ .PublishDate.Format "2006-01-02T15:04:05Z07:00" }}">
                    {{ .PublishDate.Day }}. {{ index $.Site.Data.demonths (printf "%d" .PublishDate.Month) }} {{ .PublishDate.Year }}
                  </time></span>
                </div>
              </div>
            </div>
          {{- end -}}
        </div>
      </div>
    </div>
  {{ end }}
 
{{ end }}
