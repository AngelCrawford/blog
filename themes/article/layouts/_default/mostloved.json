{{- $.Scratch.Set "mostLoved" slice -}}
{{- range where .Site.RegularPages "Section" "=" "articles" -}}

  {{- $.Scratch.Set "hasComments" 0 -}}

  {{- $postSlug := $.File.ContentBaseName -}}
  {{- $comments := index $.Site.Data.comments $postSlug -}}

  {{- range $comments -}}
    {{- $.Scratch.Add "hasComments" 1 -}}
  {{- end -}}

  {{ $hasCommentsCount := $.Scratch.Get "hasComments" }}
    
  {{ if not (eq ($hasCommentsCount) 0) }}
    {{- $.Scratch.Add "mostLoved" (dict "title" .Title "commentsCount" $hasCommentsCount "permalink" .Permalink) -}}
  {{- end -}}

{{- end -}}

{{- $.Scratch.Delete "hasComments" -}}
{{- $.Scratch.Get "mostLoved" | jsonify -}}